<div class="layout">
  <app-menu></app-menu>

  <main class="main feed-main-layout">
    <div class="feed-fixed">
      <!-- Stories -->
      <section class="stories">
        <button class="circle add">+</button>
        @for (s of stories; track $index) {
          <img class="circle" src="/avatar.png" onerror="this.onerror=null;this.src='/assets/prints/avatar.svg'" alt="story">
        }
        <span class="tag">Bombando hoje</span>
      </section>

      <!-- Destaque + People -->
      <section class="grid highlight">
        @if (posts.length > 0) {
          <article class="post big">
            <header class="p-head">
              <img class="circle" src="/avatar.png" onerror="this.onerror=null;this.src='/assets/prints/avatar.svg'" alt="autor">
              <strong>{{ posts[0].autor }}</strong>
              <span>{{ posts[0].tag }}</span>
              <time> ‚Ä¢ {{ posts[0].tempo }}</time>
            </header>

            <div class="img-wrap">
              <img class="post-img"
                   loading="lazy"
                   [src]="posts[0].img && posts[0].img.startsWith('/') ? posts[0].img : ('/assets/prints/' + posts[0].img)"
                   onerror="this.onerror=null;this.src='/assets/prints/Outback.jpeg'"
                   alt="post"/>
            </div>

            <footer class="p-foot">
              <button class="pill-btn" (click)="toggleLike(posts[0])">
                {{ posts[0].like ? '‚ù§ Curtido' : '‚ô° Curtir' }}
              </button>

              <button class="icon-btn" (click)="toggleComments(posts[0])">
                üí¨ {{ posts[0].comments }} coment√°rios
              </button>

              <span class="muted">{{ posts[0].likes | likes }} curtidas</span>
            </footer>

            @if (posts[0].showCommentBox) {
              <div class="comment-box">
                <input [(ngModel)]="posts[0].newComment" placeholder="Escreva um coment√°rio..."/>
                <button class="pill-btn" (click)="addComment(posts[0])">Enviar</button>
              </div>
            }

            @if (posts[0].commentsList?.length) {
              <ul>
                @for (c of posts[0].commentsList; track $index) {
                  <li>{{ c }}</li>
                }
              </ul>
            }
          </article>
        }

        <aside class="people">
          <h3>People</h3>
          <div class="cards">
            <div class="card">
              <img src="/avatar.png" onerror="this.onerror=null;this.src='/assets/prints/avatar.svg'" alt="Mia">
              <b>Mia</b><button>Seguir</button>
            </div>
            <div class="card">
              <img src="/avatar.png" onerror="this.onerror=null;this.src='/assets/prints/avatar.svg'" alt="Elina">
              <b>Elina</b><button>Seguir</button>
            </div>
            <div class="card">
              <img src="/avatar.png" onerror="this.onerror=null;this.src='/assets/prints/avatar.svg'" alt="John">
              <b>John</b><button>Seguir</button>
            </div>
            <div class="card">
              <img src="/avatar.png" onerror="this.onerror=null;this.src='/assets/prints/avatar.svg'" alt="David">
              <b>David</b><button>Seguir</button>
            </div>
          </div>
        </aside>
      </section>
    </div>

    <!-- Posts abaixo -->
    <div class="feed-scrollable">
      <section class="posts">
        @for (p of posts.slice(1); track $index) {
          <article class="post">
            <header class="p-head">
              <img class="circle" src="/avatar.png" onerror="this.onerror=null;this.src='/assets/prints/avatar.svg'" alt="autor">
              <strong>{{ p.autor }}</strong>
              <span>{{ p.tag }}</span>
              <time> ‚Ä¢ {{ p.tempo }}</time>
            </header>

            <div class="img-wrap">
              <img class="post-img"
                   loading="lazy"
                   [src]="p.img && p.img.startsWith('/') ? p.img : ('/assets/prints/' + p.img)" 
                   onerror="this.onerror=null;this.src='/assets/prints/gusto.jpg'"
                   alt="post"/>
            </div>

            <footer class="p-foot">
              <button class="pill-btn" (click)="toggleLike(p)">
                {{ p.like ? '‚ù§ Curtido' : '‚ô° Curtir' }}
              </button>

              <button class="icon-btn" (click)="toggleComments(p)">
                üí¨ {{ p.comments }} coment√°rios
              </button>

              <span class="muted">{{ p.likes | likes }} curtidas</span>
            </footer>

            @if (p.showCommentBox) {
              <div class="comment-box">
                <input [(ngModel)]="p.newComment" placeholder="Escreva um coment√°rio...">
                <button class="pill-btn" (click)="addComment(p)">Enviar</button>
              </div>
            }

            @if (p.commentsList?.length) {
              <ul>
                @for (c of p.commentsList; track $index) {
                  <li>{{ c }}</li>
                }
              </ul>
            }
          </article>
        }
      </section>
    </div>
  </main>
</div>
