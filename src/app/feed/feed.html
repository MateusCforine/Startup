<div class="layout">
  <app-menu></app-menu>

  <main class="main feed-main-layout">
    <div class="feed-fixed">
      <!-- Stories -->
      <section class="stories">
        <button class="circle add">+</button>
        @for (s of stories; track $index) {
          <img class="circle" src="/avatar.png"
               onerror="this.onerror=null;this.src='/avatar.png'"
               alt="story">
        }
        <span class="tag">Bombando hoje</span>
      </section>

      <!-- Grid com posts Ã  esquerda e People Ã  direita -->
      <section class="grid highlight">
        <div class="posts-col">
          @if (loading) {
            <article class="post skeleton">
              <div class="p-head">
                <div class="sk-avatar"></div>
                <div class="sk-line w80"></div>
              </div>
              <div class="sk-media"></div>
              <div class="p-foot">
                <div class="sk-pill"></div>
                <div class="sk-pill"></div>
              </div>
            </article>
            <article class="post skeleton">
              <div class="p-head">
                <div class="sk-avatar"></div>
                <div class="sk-line w60"></div>
              </div>
              <div class="sk-media"></div>
              <div class="p-foot">
                <div class="sk-pill"></div>
                <div class="sk-pill"></div>
              </div>
            </article>
          } @else if (!posts.length) {
            <p class="muted">Nenhum post encontrado.</p>
          }
          @for (p of posts; track p._id ?? $index) {
            <article class="post big" [attr.id]="'post-' + (p._id || $index)">
              <header class="p-head">
                <img class="circle" src="/avatar.png"
                     onerror="this.onerror=null;this.src='/avatar.png'" alt="autor">
                <strong>{{ p.autor }}</strong>
                <span>{{ p.tag }}</span>
                <time> â€¢ {{ p.tempo }}</time>
              </header>

              <div class="img-wrap">
                @if (isVideo(p.img)) {
                  <video class="post-img" [src]="p.img" controls playsinline></video>
                } @else {
                  <img class="post-img"
                       loading="lazy"
                       [src]="p.img"
                       onerror="this.onerror=null;this.src='/gusto.jpg'"
                       alt="post image">
                }
              </div>

              <footer class="p-foot">
                <button class="pill-btn" [class.liked]="p.like" (click)="toggleLike(p)">
                  {{ p.like ? 'âœ“ Curtido' : 'â™¡ Curtir' }}
                </button>
                <button class="icon-btn" (click)="toggleComments(p)" title="ComentÃ¡rios">
                  ðŸ’¬ {{ p.comments }} comentÃ¡rios
                </button>
                <button class="icon-btn" (click)="toggleBookmark(p)" [class.active]="p.bookmark" title="Salvar">
                  {{ p.bookmark ? 'â˜… Salvo' : 'â˜† Salvar' }}
                </button>
                <button class="icon-btn" (click)="copyLink(p)" title="Compartilhar">â¤´ Compartilhar</button>
                <span class="muted">{{ p.likes | likes }} curtidas</span>
              </footer>

              @if (p.showCommentBox) {
                <div class="comment-box">
                  <input [(ngModel)]="p.newComment" placeholder="Escreva um comentÃ¡rio..." (keyup.enter)="addComment(p)" />
                  <button class="pill-btn" (click)="addComment(p)">Enviar</button>
                </div>
              }

              @if (p.commentsList?.length) {
                <ul>
                  @for (c of p.commentsList; track $index) {
                    <li>{{ c }}</li>
                  }
                </ul>
              }
            </article>
          }
        </div>

        <!-- People -->
        <aside class="people">
          <h3>SugestÃµes</h3>
          <div class="cards">
            <div class="card">
              <img src="/avatar.png"
                   onerror="this.onerror=null;this.src='/avatar.png'" alt="Mia">
              <b>Mia</b><button>Seguir</button>
            </div>
            <div class="card">
              <img src="/avatar.png"
                   onerror="this.onerror=null;this.src='/avatar.png'" alt="Elina">
              <b>Elina</b><button>Seguir</button>
            </div>
            <div class="card">
              <img src="/avatar.png"
                   onerror="this.onerror=null;this.src='/avatar.png'" alt="John">
              <b>John</b><button>Seguir</button>
            </div>
            <div class="card">
              <img src="/avatar.png"
                   onerror="this.onerror=null;this.src='/avatar.png'" alt="David">
              <b>David</b><button>Seguir</button>
            </div>
          </div>
        </aside>
      </section>
    </div>
  </main>
  
  @if (showScrollTop) {
    <button class="scroll-top" (click)="scrollToTop()" title="Voltar ao topo">â†‘</button>
  }
</div>
